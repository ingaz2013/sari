# 🧙‍♂️ معالج الإعداد الذكي لساري - التصور الكامل

**التاريخ:** ديسمبر 2024  
**الإصدار:** 2.0 (المحسّن)  
**الفلسفة:** جمع المعلومات تلقائياً بدلاً من طلبها يدوياً

---

## 🎯 الفكرة الأساسية

بدلاً من سؤال التاجر عن كل تفصيلة، **نستخرج المعلومات تلقائياً** من:
1. رابط موقعه/متجره
2. تحليل صفحاته ومنتجاته
3. اكتشاف نوع النشاط تلقائياً
4. اقتراح الإعدادات المناسبة

---

## 📋 الخطوات المحسّنة

### **الخطوة 1: نوع النشاط** 🏪

#### السؤال الرئيسي:
```
مرحباً بك في ساري! 👋

ما نوع نشاطك التجاري؟

┌─────────────────────────────────┐
│  🛍️  متجر إلكتروني             │
│  (بيع منتجات)                   │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  💼  مقدم خدمات                 │
│  (حجز مواعيد، استشارات، إلخ)   │
└─────────────────────────────────┘
```

**النتيجة:**
- إذا اختار **متجر** → الانتقال للخطوة 2أ (تحليل المتجر)
- إذا اختار **خدمات** → الانتقال للخطوة 2ب (تحليل الخدمة)

---

### **الخطوة 2أ: تحليل المتجر الذكي** 🔍

#### السؤال:
```
رائع! هل لديك متجر إلكتروني حالياً؟

┌─────────────────────────────────┐
│  ✅  نعم، لدي متجر              │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  ❌  لا، سأضيف المنتجات يدوياً  │
└─────────────────────────────────┘
```

---

#### **إذا اختار "نعم":**

```
ممتاز! الصق رابط متجرك هنا:

┌─────────────────────────────────┐
│  🔗  https://                   │
│  ___________________________    │
└─────────────────────────────────┘

أو اختر منصة متجرك:

[🟢 Salla]  [🔵 Zid]  [🟠 Shopify]  [⚪ أخرى]
```

**ما يحدث خلف الكواليس:**

1. **تحليل الرابط تلقائياً:**
   - اكتشاف المنصة (Salla, Zid, Shopify, WooCommerce, مخصص)
   - استخراج اسم المتجر
   - تحليل الصفحات المتاحة
   - استخراج الفئات الرئيسية

2. **استخراج المنتجات:**
   - عدد المنتجات
   - الفئات
   - نطاق الأسعار
   - توفر الصور

3. **تحليل الصفحات المهمة:**
   - صفحة "من نحن" → استخراج وصف النشاط
   - صفحة "اتصل بنا" → استخراج معلومات التواصل
   - صفحة "الشروط والأحكام" → استخراج سياسات الإرجاع
   - صفحة "الشحن" → استخراج معلومات التوصيل
   - صفحة "الأسئلة الشائعة" → استخراج الأسئلة لتدريب ساري

4. **حفظ روابط الصفحات:**
   ```json
   {
     "about_page": "https://store.com/about",
     "contact_page": "https://store.com/contact",
     "shipping_page": "https://store.com/shipping",
     "return_policy": "https://store.com/returns",
     "faq_page": "https://store.com/faq"
   }
   ```

**النتيجة المعروضة للتاجر:**

```
✅ تم تحليل متجرك بنجاح!

📊 ما اكتشفناه:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🏪 اسم المتجر: متجر الهدايا الفاخرة
📦 عدد المنتجات: 127 منتج
📂 الفئات: هدايا، إكسسوارات، ساعات، عطور
💰 نطاق الأسعار: 50 - 2,500 ريال
🌐 المنصة: Salla

📄 الصفحات المكتشفة:
✅ من نحن
✅ سياسة الشحن
✅ سياسة الإرجاع
✅ الأسئلة الشائعة (15 سؤال)

هل المعلومات صحيحة؟
[✅ نعم، متأكد]  [✏️ تعديل]
```

---

#### **إذا اختار "لا" (سأضيف يدوياً):**

```
لا مشكلة! يمكنك إضافة المنتجات بعدة طرق:

┌─────────────────────────────────┐
│  📄  رفع ملف Excel/CSV          │
│  (تحميل قائمة جاهزة)            │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  ✍️  إضافة يدوية                │
│  (منتج تلو الآخر)               │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  ⏭️  تخطي الآن                  │
│  (سأضيف لاحقاً)                │
└─────────────────────────────────┘
```

---

### **الخطوة 2ب: تحليل الخدمة الذكي** 💼

#### السؤال:
```
رائع! هل لديك موقع لخدماتك؟

┌─────────────────────────────────┐
│  ✅  نعم، لدي موقع               │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  ❌  لا، سأدخل المعلومات يدوياً │
└─────────────────────────────────┘
```

---

#### **إذا اختار "نعم":**

```
ممتاز! الصق رابط موقعك هنا:

┌─────────────────────────────────┐
│  🔗  https://                   │
│  ___________________________    │
└─────────────────────────────────┘
```

**ما يحدث خلف الكواليس:**

1. **تحليل الموقع:**
   - اكتشاف نوع الخدمة (عيادة، صالون، استشارات، تدريب، إلخ)
   - استخراج قائمة الخدمات المقدمة
   - استخراج الأسعار (إن وجدت)
   - استخراج أسماء الموظفين/الأطباء/المدربين

2. **تحليل الصفحات المهمة:**
   - صفحة "الخدمات" → استخراج قائمة الخدمات
   - صفحة "الفريق" → استخراج أسماء الموظفين
   - صفحة "حجز موعد" → اكتشاف نظام الحجز الحالي
   - صفحة "الأسعار" → استخراج قائمة الأسعار
   - صفحة "الأسئلة الشائعة" → تدريب ساري

3. **حفظ روابط الصفحات:**
   ```json
   {
     "services_page": "https://clinic.com/services",
     "team_page": "https://clinic.com/team",
     "booking_page": "https://clinic.com/book",
     "pricing_page": "https://clinic.com/pricing",
     "faq_page": "https://clinic.com/faq"
   }
   ```

**النتيجة المعروضة:**

```
✅ تم تحليل موقعك بنجاح!

📊 ما اكتشفناه:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🏥 نوع الخدمة: عيادة طبية
👨‍⚕️ الأطباء: د. أحمد، د. فاطمة، د. محمد
💼 الخدمات: 
   • كشف عام (150 ريال)
   • استشارة متخصصة (300 ريال)
   • فحص شامل (500 ريال)
⏰ ساعات العمل: 9 صباحاً - 9 مساءً

📄 الصفحات المكتشفة:
✅ الخدمات
✅ الفريق الطبي
✅ الأسعار
✅ الأسئلة الشائعة (12 سؤال)

هل المعلومات صحيحة؟
[✅ نعم، متأكد]  [✏️ تعديل]
```

---

#### **إذا اختار "لا":**

```
لا مشكلة! دعنا نضيف خدماتك:

ما نوع خدمتك؟

[🏥 عيادة/مركز طبي]
[💇 صالون/سبا]
[💼 استشارات مهنية]
[🎓 تدريب وتعليم]
[🏗️ مقاولات وصيانة]
[📸 تصوير وتصميم]
[⚖️ خدمات قانونية]
[📊 خدمات محاسبية]
[🚗 خدمات سيارات]
[🏠 خدمات منزلية]
[📦 أخرى]
```

**بعد الاختيار:**

```
رائع! الآن أضف خدماتك:

┌─────────────────────────────────┐
│  اسم الخدمة: ____________       │
│  السعر: _______ ريال            │
│  المدة: _______ دقيقة           │
│  [+ إضافة خدمة أخرى]            │
└─────────────────────────────────┘
```

---

### **الخطوة 3: التكامل مع المنصات** 🔗

**للمتاجر الإلكترونية:**

```
هل تريد ربط ساري مع متجرك تلقائياً؟

┌─────────────────────────────────┐
│  🟢 Salla                        │
│  مزامنة المنتجات والطلبات      │
│  [ربط الآن]                     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  🔵 Zid                          │
│  مزامنة المنتجات والطلبات      │
│  [ربط الآن]                     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  🟠 Shopify                      │
│  مزامنة المنتجات والطلبات      │
│  [ربط الآن]                     │
└─────────────────────────────────┘

[⏭️ تخطي - سأربط لاحقاً]
```

**لمقدمي الخدمات:**

```
هل تريد ربط ساري مع أدوات الحجز؟

┌─────────────────────────────────┐
│  📅 Google Calendar              │
│  مزامنة المواعيد تلقائياً      │
│  [ربط الآن]                     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  🗓️ Calendly                     │
│  نظام حجز احترافي               │
│  [ربط الآن]                     │
└─────────────────────────────────┘

[⏭️ تخطي - سأربط لاحقاً]
```

---

### **الخطوة 4: تدريب ساري على عملك** 🤖

```
الآن دعنا ندرب ساري على نشاطك!

📚 ما جمعناه من موقعك:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 127 منتج من متجرك
✅ 15 سؤال من صفحة الأسئلة الشائعة
✅ سياسة الشحن والإرجاع
✅ معلومات التواصل

🎓 هل تريد إضافة معلومات إضافية؟

┌─────────────────────────────────┐
│  ✍️  إضافة أسئلة شائعة إضافية  │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  📝  إضافة ملاحظات خاصة         │
│  (مثل: عروض حالية، شروط خاصة)  │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  🔗  إضافة روابط مهمة            │
│  (مثل: فيديوهات، كتالوجات)     │
└─────────────────────────────────┘

[✅ كفاية، ساري جاهز]
```

---

### **الخطوة 5: تخصيص شخصية ساري** 🎭

```
كيف تريد ساري يتكلم مع عملائك؟

┌─────────────────────────────────┐
│  😊 ودود وقريب                  │
│  "أهلاً! كيف أقدر أساعدك؟"     │
│  [اختيار]                       │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  💼 رسمي واحترافي                │
│  "مرحباً بك، كيف يمكنني خدمتك؟" │
│  [اختيار]                       │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  ⚡ مختصر وسريع                  │
│  "أهلاً، كيف أساعدك؟"           │
│  [اختيار]                       │
└─────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 رسالة الترحيب:
┌─────────────────────────────────┐
│  مرحباً! أنا ساري 👋            │
│  مساعدك الذكي في [اسم المتجر]  │
│                                 │
│  كيف أقدر أساعدك اليوم؟         │
│  [✏️ تعديل]                     │
└─────────────────────────────────┘

🌙 رسالة خارج أوقات العمل:
┌─────────────────────────────────┐
│  شكراً لتواصلك! 🌙              │
│  حالياً خارج أوقات العمل.       │
│  ساعات العمل: 9 صباحاً - 9 مساءً│
│                                 │
│  بنرد عليك في أقرب وقت ممكن.    │
│  [✏️ تعديل]                     │
└─────────────────────────────────┘
```

---

### **الخطوة 6: ربط WhatsApp** 📱

```
الآن دعنا نربط رقم WhatsApp Business:

┌─────────────────────────────────┐
│  📱 رقم WhatsApp                │
│  +966 ___ ___ ____              │
└─────────────────────────────────┘

⚠️ ملاحظة مهمة:
• يجب أن يكون رقم WhatsApp Business
• لا يمكن استخدام رقمك الشخصي
• الرقم يجب أن يكون غير مستخدم في أي تطبيق واتساب آخر

[📋 كيف أحصل على رقم WhatsApp Business؟]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

بعد إدخال الرقم:

✅ تم إرسال طلب الربط للمدير
⏳ سيتم الموافقة خلال 24 ساعة
📧 سنرسل لك إشعار عند الموافقة

[⏭️ التالي]
```

---

### **الخطوة 7: إعداد بوابة الدفع** 💳

**للمتاجر:**

```
كيف تريد عملائك يدفعون؟

┌─────────────────────────────────┐
│  💳 Tap Payment (مفعّل)          │
│  Mada, Visa, Mastercard         │
│  ✅ جاهز للاستخدام              │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  💰 PayLink (قريباً)             │
│  روابط دفع سريعة                │
│  [قريباً]                       │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  📱 Paymob (قريباً)              │
│  دعم التقسيط (Tabby, Tamara)    │
│  [قريباً]                       │
└─────────────────────────────────┘

[⏭️ التالي]
```

**لمقدمي الخدمات:**

```
هل تريد قبول الدفع المسبق عند الحجز؟

┌─────────────────────────────────┐
│  ✅ نعم، دفع مسبق إلزامي         │
│  (لتأكيد الحجز)                 │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  💰 دفع جزئي (عربون)            │
│  المبلغ: _____ ريال             │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  ❌ لا، الدفع عند الحضور         │
└─────────────────────────────────┘
```

---

### **الخطوة 8: اختبار ساري** 🧪

```
🎉 ساري جاهز تقريباً!

دعنا نختبره قبل الإطلاق:

┌─────────────────────────────────┐
│  💬 اختبار المحادثة             │
│  جرّب الدردشة مع ساري الآن      │
│  [ابدأ الاختبار]                │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  📦 اختبار الطلب                │
│  جرّب طلب منتج كامل             │
│  [ابدأ الاختبار]                │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  📅 اختبار الحجز (للخدمات)      │
│  جرّب حجز موعد                  │
│  [ابدأ الاختبار]                │
└─────────────────────────────────┘

[⏭️ تخطي الاختبار]
```

**مثال على اختبار المحادثة:**

```
┌─────────────────────────────────┐
│  💬 محاكاة محادثة WhatsApp       │
│                                 │
│  أنت (العميل):                  │
│  ┌─────────────────────────┐   │
│  │ أبي ساعة ذكية           │   │
│  └─────────────────────────┘   │
│                                 │
│  ساري:                          │
│  ┌─────────────────────────┐   │
│  │ أهلاً! عندنا ساعات      │   │
│  │ ذكية رائعة:             │   │
│  │                          │   │
│  │ 1. Apple Watch (1,200 ر) │   │
│  │ 2. Samsung Watch (800 ر) │   │
│  │ 3. Xiaomi Watch (300 ر)  │   │
│  │                          │   │
│  │ أي وحدة تفضل؟            │   │
│  └─────────────────────────┘   │
│                                 │
│  [✅ ممتاز]  [❌ يحتاج تحسين]   │
└─────────────────────────────────┘
```

---

### **الخطوة 9: الإطلاق! 🚀**

```
🎉 مبروك! ساري جاهز للانطلاق!

✅ ما تم إعداده:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🏪 نوع النشاط: متجر إلكتروني
📦 المنتجات: 127 منتج
🤖 ساري مدرب على: 15 سؤال شائع
📱 WhatsApp: +966 50 123 4567 (قيد الموافقة)
💳 الدفع: Tap Payment
🔗 التكاملات: Salla, Google Sheets

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 الخطوات التالية:

┌─────────────────────────────────┐
│  📈 شاهد لوحة التحكم             │
│  [فتح Dashboard]                │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  📱 أرسل رسالة تجريبية           │
│  [إرسال الآن]                   │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  👥 ادعُ فريق العمل              │
│  [إضافة مستخدمين]               │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  📚 شاهد الدليل التعليمي        │
│  [فتح الدليل]                   │
└─────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 نصيحة: ابدأ بإرسال رسالة تجريبية 
   لنفسك للتأكد من أن كل شيء يعمل!
```

---

## 🎨 التصميم التقني

### قاعدة البيانات

```sql
-- جدول: wizard_progress
CREATE TABLE wizard_progress (
  id INT PRIMARY KEY AUTO_INCREMENT,
  merchant_id INT NOT NULL,
  current_step INT DEFAULT 1,
  completed BOOLEAN DEFAULT FALSE,
  
  -- بيانات الخطوات
  business_type ENUM('store', 'service'),
  website_url VARCHAR(500),
  website_analysis JSON, -- نتائج التحليل التلقائي
  
  -- بيانات المتجر
  store_platform VARCHAR(50), -- salla, zid, shopify, custom
  products_count INT,
  categories JSON,
  
  -- بيانات الخدمة
  service_type VARCHAR(100),
  services JSON, -- قائمة الخدمات
  team_members JSON, -- قائمة الموظفين
  
  -- الصفحات المكتشفة
  discovered_pages JSON,
  
  -- التكاملات
  integrations JSON,
  
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (merchant_id) REFERENCES merchants(id)
);

-- جدول: discovered_pages
CREATE TABLE discovered_pages (
  id INT PRIMARY KEY AUTO_INCREMENT,
  merchant_id INT NOT NULL,
  page_type VARCHAR(50), -- about, faq, shipping, returns, services, team
  page_url VARCHAR(500),
  page_title VARCHAR(255),
  content TEXT, -- المحتوى المستخرج
  use_in_responses BOOLEAN DEFAULT TRUE, -- استخدام في ردود ساري
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (merchant_id) REFERENCES merchants(id)
);

-- جدول: extracted_faqs
CREATE TABLE extracted_faqs (
  id INT PRIMARY KEY AUTO_INCREMENT,
  merchant_id INT NOT NULL,
  question TEXT NOT NULL,
  answer TEXT NOT NULL,
  source VARCHAR(50), -- 'website' or 'manual'
  source_url VARCHAR(500),
  enabled BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (merchant_id) REFERENCES merchants(id)
);
```

---

## 🔧 APIs المطلوبة

### 1. تحليل الموقع
```typescript
// POST /api/wizard/analyze-website
{
  url: string,
  business_type: 'store' | 'service'
}

// Response
{
  success: boolean,
  data: {
    business_name: string,
    platform: string, // salla, zid, shopify, custom
    products_count: number,
    categories: string[],
    services: Array<{name: string, price: number}>,
    team_members: string[],
    discovered_pages: Array<{
      type: string,
      url: string,
      title: string,
      content: string
    }>,
    extracted_faqs: Array<{
      question: string,
      answer: string
    }>
  }
}
```

### 2. حفظ تقدم المعالج
```typescript
// POST /api/wizard/save-progress
{
  step: number,
  data: any
}
```

### 3. إكمال المعالج
```typescript
// POST /api/wizard/complete
{
  wizard_data: any
}
```

---

## 🤖 خوارزمية التحليل الذكي

### للمتاجر الإلكترونية:

```javascript
async function analyzeStore(url) {
  // 1. اكتشاف المنصة
  const platform = detectPlatform(url);
  
  // 2. استخراج المنتجات
  let products = [];
  if (platform === 'salla') {
    products = await fetchSallaProducts(url);
  } else if (platform === 'zid') {
    products = await fetchZidProducts(url);
  } else {
    products = await scrapeProducts(url);
  }
  
  // 3. تحليل الصفحات
  const pages = await discoverPages(url);
  
  // 4. استخراج الأسئلة الشائعة
  const faqs = await extractFAQs(pages.faq_page);
  
  // 5. استخراج السياسات
  const policies = {
    shipping: await extractShippingPolicy(pages.shipping_page),
    returns: await extractReturnPolicy(pages.returns_page)
  };
  
  return {
    platform,
    products,
    pages,
    faqs,
    policies
  };
}
```

### لمقدمي الخدمات:

```javascript
async function analyzeServiceWebsite(url) {
  // 1. اكتشاف نوع الخدمة
  const serviceType = await detectServiceType(url);
  
  // 2. استخراج الخدمات
  const services = await extractServices(url);
  
  // 3. استخراج الفريق
  const team = await extractTeamMembers(url);
  
  // 4. استخراج الأسعار
  const pricing = await extractPricing(url);
  
  // 5. تحليل الصفحات
  const pages = await discoverPages(url);
  
  // 6. استخراج الأسئلة الشائعة
  const faqs = await extractFAQs(pages.faq_page);
  
  return {
    serviceType,
    services,
    team,
    pricing,
    pages,
    faqs
  };
}
```

---

## 📊 الجدول الزمني للتطوير

| المرحلة | المدة | الوصف |
|---------|-------|-------|
| **1. تصميم الواجهة** | 3 أيام | تصميم جميع الخطوات والشاشات |
| **2. خوارزمية التحليل** | 5 أيام | تطوير نظام تحليل المواقع |
| **3. قاعدة البيانات** | 2 يوم | إنشاء الجداول والعلاقات |
| **4. APIs** | 4 أيام | تطوير جميع الـ APIs |
| **5. Frontend** | 7 أيام | بناء واجهة المعالج |
| **6. التكاملات** | 5 أيام | ربط مع Salla, Zid, Google |
| **7. الاختبار** | 4 أيام | اختبار شامل |
| **الإجمالي** | **30 يوم** | شهر واحد |

---

## 🎯 المميزات الرئيسية

✅ **تحليل تلقائي ذكي** - استخراج المعلومات من الموقع  
✅ **حفظ الصفحات المهمة** - لاستخدامها في الردود  
✅ **تدريب ساري تلقائياً** - من الأسئلة الشائعة  
✅ **تخصيص كامل** - شخصية ساري والرسائل  
✅ **اختبار مباشر** - قبل الإطلاق  
✅ **إعداد سريع** - 5-15 دقيقة فقط  

---

## 💡 الخلاصة

هذا المعالج الذكي يحول عملية الإعداد من **مهمة معقدة تستغرق ساعات** إلى **تجربة سلسة تستغرق دقائق** من خلال:

1. **الذكاء في جمع المعلومات** - بدلاً من طلبها يدوياً
2. **التحليل التلقائي** - للمواقع والمتاجر
3. **التدريب الذاتي** - لساري على نشاط التاجر
4. **التخصيص السهل** - مع معاينة مباشرة

النتيجة: **تاجر سعيد + ساري جاهز للعمل في أقل من 15 دقيقة!** 🚀
